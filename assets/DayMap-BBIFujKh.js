import{r as l,R as S,j as a}from"./motion-vendor-B3aZs4py.js";import{a as W}from"./react-vendor-DlBnNAMw.js";import{l as C,L as w}from"./index-DGwj00ZI.js";import{X,o as Y,G as q,ai as K}from"./icons-vendor-BCqdgPG-.js";var H=W();function A(o,t){const e=l.useRef(t);l.useEffect(function(){t!==e.current&&o.attributionControl!=null&&(e.current!=null&&o.attributionControl.removeAttribution(e.current),t!=null&&o.attributionControl.addAttribution(t)),e.current=t},[o,t])}const Q=1;function M(o){return Object.freeze({__version:Q,map:o})}function B(o,t){return Object.freeze({...o,...t})}const k=l.createContext(null);function R(){const o=l.use(k);if(o==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return o}function Z(o){function t(e,n){const{instance:r,context:i}=o(e).current;l.useImperativeHandle(n,()=>r);const{children:s}=e;return s==null?null:S.createElement(k,{value:i},s)}return l.forwardRef(t)}function D(o){function t(e,n){const[r,i]=l.useState(!1),{instance:s}=o(e,i).current;l.useImperativeHandle(n,()=>s),l.useEffect(function(){r&&s.update()},[s,r,e.children]);const u=s._contentNode;return u?H.createPortal(e.children,u):null}return l.forwardRef(t)}function ee(o){function t(e,n){const{instance:r}=o(e).current;return l.useImperativeHandle(n,()=>r),null}return l.forwardRef(t)}function _(o,t){const e=l.useRef(void 0);l.useEffect(function(){return t!=null&&o.instance.on(t),e.current=t,function(){e.current!=null&&o.instance.off(e.current),e.current=null}},[o,t])}function I(o,t){const e=o.pane??t.pane;return e?{...o,pane:e}:o}function te(o,t){return function(n,r){const i=R(),s=o(I(n,i),i);return A(i.map,n.attribution),_(s.current,n.eventHandlers),t(s.current,i,n,r),s}}function L(o,t,e){return Object.freeze({instance:o,context:t,container:e})}function P(o,t){return t==null?function(n,r){const i=l.useRef(void 0);return i.current||(i.current=o(n,r)),i}:function(n,r){const i=l.useRef(void 0);i.current||(i.current=o(n,r));const s=l.useRef(n),{instance:u}=i.current;return l.useEffect(function(){s.current!==n&&(t(u,n,s.current),s.current=n)},[u,n,t]),i}}function J(o,t){l.useEffect(function(){return(t.layerContainer??t.map).addLayer(o.instance),function(){t.layerContainer?.removeLayer(o.instance),t.map.removeLayer(o.instance)}},[t,o])}function V(o){return function(e){const n=R(),r=o(I(e,n),n);return A(n.map,e.attribution),_(r.current,e.eventHandlers),J(r.current,n),r}}function ne(o,t){const e=l.useRef(void 0);l.useEffect(function(){if(t.pathOptions!==e.current){const r=t.pathOptions??{};o.instance.setStyle(r),e.current=r}},[o,t])}function oe(o){return function(e){const n=R(),r=o(I(e,n),n);return _(r.current,e.eventHandlers),J(r.current,n),ne(r.current,e),r}}function re(o,t){const e=P(o,t),n=V(e);return Z(n)}function ae(o,t){const e=P(o),n=te(e,t);return D(n)}function se(o,t){const e=P(o,t),n=oe(e);return Z(n)}function ie(o,t){const e=P(o,t),n=V(e);return ee(n)}function le(o,t,e){const{opacity:n,zIndex:r}=t;n!=null&&n!==e.opacity&&o.setOpacity(n),r!=null&&r!==e.zIndex&&o.setZIndex(r)}function F(){return R().map}function ce({bounds:o,boundsOptions:t,center:e,children:n,className:r,id:i,placeholder:s,style:u,whenReady:f,zoom:p,...h},v){const[b]=l.useState({className:r,id:i,style:u}),[x,j]=l.useState(null),c=l.useRef(void 0);l.useImperativeHandle(v,()=>x?.map??null,[x]);const d=l.useCallback(N=>{if(N!==null&&!c.current){const g=new C.Map(N,h);c.current=g,e!=null&&p!=null?g.setView(e,p):o!=null&&g.fitBounds(o,t),f!=null&&g.whenReady(f),j(M(g))}},[]);l.useEffect(()=>()=>{x?.map.remove()},[x]);const m=x?S.createElement(k,{value:x},n):s??null;return S.createElement("div",{...b,ref:d},m)}const U=l.forwardRef(ce),z=re(function({position:t,...e},n){const r=new C.Marker(t,e);return L(r,B(n,{overlayContainer:r}))},function(t,e,n){e.position!==n.position&&t.setLatLng(e.position),e.icon!=null&&e.icon!==n.icon&&t.setIcon(e.icon),e.zIndexOffset!=null&&e.zIndexOffset!==n.zIndexOffset&&t.setZIndexOffset(e.zIndexOffset),e.opacity!=null&&e.opacity!==n.opacity&&t.setOpacity(e.opacity),t.dragging!=null&&e.draggable!==n.draggable&&(e.draggable===!0?t.dragging.enable():t.dragging.disable())}),y=se(function({positions:t,...e},n){const r=new C.Polyline(t,e);return L(r,B(n,{overlayContainer:r}))},function(t,e,n){e.positions!==n.positions&&t.setLatLngs(e.positions)}),O=ae(function(t,e){const n=new C.Popup(t,e.overlayContainer);return L(n,e)},function(t,e,{position:n},r){l.useEffect(function(){const{instance:s}=t;function u(p){p.popup===s&&(s.update(),r(!0))}function f(p){p.popup===s&&r(!1)}return e.map.on({popupopen:u,popupclose:f}),e.overlayContainer==null?(n!=null&&s.setLatLng(n),s.openOn(e.map)):e.overlayContainer.bindPopup(s),function(){e.map.off({popupopen:u,popupclose:f}),e.overlayContainer?.unbindPopup(),e.map.removeLayer(s)}},[t,e,r,n])}),G=ie(function({url:t,...e},n){const r=new C.TileLayer(t,I(e,n));return L(r,n)},function(t,e,n){le(t,e,n);const{url:r}=e;r!=null&&r!==n.url&&t.setUrl(r)}),ue=({events:o,userLocation:t,routeCoords:e})=>{const n=F(),r=l.useRef(!1),i=()=>{const s=[];if(o.forEach(u=>{u.lat&&u.lon&&s.push([u.lat,u.lon])}),e&&e.length>0&&e.filter((u,f)=>f%10===0).forEach(u=>s.push(u)),t&&t.lat&&t.lon&&s.push([t.lat,t.lon]),s.length>0){const u=w.latLngBounds(s);n.fitBounds(u,{padding:[50,50],animate:!0})}};return l.useEffect(()=>{const s=[setTimeout(()=>n.invalidateSize(),100),setTimeout(()=>n.invalidateSize(),500),setTimeout(()=>{n.invalidateSize(),r.current||(i(),r.current=!0)},1e3)];return()=>s.forEach(u=>clearTimeout(u))},[n]),a.jsx("button",{onClick:i,className:"absolute bottom-6 right-6 z-[1000] p-3 rounded-2xl bg-white/90 dark:bg-neutral-800/90 shadow-xl border border-stone-200 dark:border-neutral-700 text-stone-600 dark:text-neutral-300 hover:scale-110 active:scale-95 transition-all",title:"é‡ç½®è¦–é‡Ž",children:a.jsx(Y,{className:"w-5 h-5"})})},de=({isOpen:o,onClose:t,isDarkMode:e,events:n,userLocation:r,routeCoords:i,theme:s})=>{const u=l.useMemo(()=>{const c=n.filter(d=>d.lat&&d.lon);return{center:c.length>0?[c[0].lat,c[0].lon]:[35.6895,139.6917],zoom:13}},[o]),f=l.useMemo(()=>n.filter(c=>c.lat&&c.lon),[n]);if(l.useEffect(()=>(o?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[o]),!o)return null;const p="https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",h=e?s?.glassColors?.card?.dark||"bg-[#262626]/90 backdrop-blur-md border-white/10 shadow-[inset_0_1px_1px_rgba(255,255,255,0.08)]":s?.glassColors?.card?.light||"bg-white/90 backdrop-blur-md border-white/20 shadow-[inset_0_1px_1px_rgba(255,255,255,0.15)]",v=e?s?.textColors?.dark||"text-stone-100":s?.textColors?.light||"text-stone-800",b=e?s?.textColors?.secDark||"text-stone-300":s?.textColors?.secLight||"text-stone-500",x=(c,d)=>new w.DivIcon({className:"custom-numbered-marker",html:`
        <div style="
          position: relative;
          width: 32px;
          height: 32px;
          background: ${d?"linear-gradient(135deg, #60a5fa 0%, #0ea5e9 100%)":"linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)"};
          border: 3px solid white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: bold;
          font-size: 14px;
          box-shadow: ${d?"0 0 16px rgba(96, 165, 250, 0.5), 0 3px 10px rgba(0, 0, 0, 0.4)":"0 3px 10px rgba(0, 0, 0, 0.2)"};
        ">
          ${c+1}
        </div>
      `,iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[0,-16]}),j=new w.DivIcon({className:"custom-user-icon",html:`
      <div style="position: relative; width: 20px; height: 20px; background-color: #10b981; border: 2px solid white; border-radius: 50%; box-shadow: 0 0 12px rgba(16, 185, 129, 0.5), 0 2px 6px rgba(0,0,0,0.3); z-index: 1000;">
        <div style="position: absolute; top: -10px; left: -10px; width: 40px; height: 40px; background-color: rgba(16, 185, 129, 0.25); border-radius: 50%; animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;"></div>
      </div>
      <style> @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } } </style>
    `,iconSize:[20,20],iconAnchor:[10,10]});return a.jsxs("div",{className:"fixed inset-0 z-[5000] flex items-center justify-center p-4 sm:p-6",onTouchStart:c=>{c.target===c.currentTarget&&c.stopPropagation()},onTouchMove:c=>{c.target.closest(".leaflet-container")||c.stopPropagation()},children:[a.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:t}),a.jsxs("div",{className:`relative w-full max-w-4xl h-[85vh] rounded-[32px] overflow-hidden border shadow-2xl flex flex-col animate-modal-in ${h}`,children:[a.jsxs("div",{className:`flex items-center justify-between p-6 border-b ${e?"border-white/5 bg-white/5":"border-stone-200/50 bg-stone-50/50"}`,onTouchStart:c=>c.stopPropagation(),children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:`text-[10px] font-black tracking-[0.2em] uppercase mb-1 ${e?"text-neutral-500":"text-stone-400"}`,children:"Interactive Map"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h2",{className:`text-xl font-bold ${v}`,children:"ç•¶å‰è·¯ç·šå°Žè¦½"}),a.jsx("div",{className:`px-2 py-0.5 rounded-md text-[10px] font-bold ${e?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-600"}`,children:"LIVE"})]})]}),a.jsx("button",{onClick:t,className:`p-2 rounded-full transition-all active:scale-90 ${e?"bg-white/10 hover:bg-white/20 text-white":"bg-stone-200 hover:bg-stone-300 text-stone-600"}`,children:a.jsx(X,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex-1 relative",children:a.jsxs(U,{center:u.center,zoom:u.zoom,style:{height:"100%",width:"100%"},zoomControl:!0,dragging:!0,touchZoom:!0,preferCanvas:!0,bounceAtZoomLimits:!1,children:[a.jsx(G,{attribution:"Â© CARTO, Â© OpenStreetMap",url:p,updateWhenIdle:!1,keepBuffer:3}),a.jsx(ue,{events:f,userLocation:r,routeCoords:i}),i&&i.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(y,{positions:i,pathOptions:{color:e?"rgba(0, 0, 0, 0.4)":"white",weight:10,opacity:.6}}),a.jsx(y,{positions:i,pathOptions:{color:e?"#00d4ff":"#3b82f6",weight:e?6:5,opacity:e?1:.9,lineCap:"round",lineJoin:"round"}}),e&&a.jsx(y,{positions:i,pathOptions:{color:"#00d4ff",weight:6,opacity:.3,lineCap:"round",lineJoin:"round"}})]}),f.map((c,d)=>a.jsx(z,{position:[c.lat,c.lon],icon:x(d,e),children:a.jsx(O,{className:"custom-popup",closeButton:!1,children:a.jsxs("div",{className:`p-4 rounded-2xl shadow-xl border backdrop-blur-md -m-[13px] -mb-[14px] min-w-[200px] ${e?"bg-[#1a1a1a]/95 border-neutral-700 text-neutral-200":"bg-white/95 border-stone-100 text-stone-800"}`,children:[a.jsxs("div",{className:"font-bold text-base mb-2 flex items-center gap-2",children:[a.jsx("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-blue-500 text-white text-[10px] font-bold",children:d+1}),c.time," ",c.title]}),a.jsx("div",{className:`text-sm leading-relaxed ${b}`,children:c.desc})]})})},d)),r&&r.lat&&r.lon&&a.jsx(z,{position:[r.lat,r.lon],icon:j,zIndexOffset:1e3,children:a.jsx(O,{closeButton:!1,className:"custom-popup",children:a.jsx("div",{className:"p-2 px-4 rounded-full bg-emerald-500 shadow-lg -m-[13px] -mb-[14px]",children:a.jsx("div",{className:"font-bold text-xs text-white text-center whitespace-nowrap",children:"æ‚¨çš„ä½ç½®"})})})})]})}),a.jsx("div",{className:`p-5 border-t flex items-center ${e?"border-white/5 bg-white/5":"border-stone-200/50 bg-stone-50/30"}`,children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),a.jsx("div",{className:`text-xs font-medium ${b}`,children:"é»žæ“Šæ¨™è¨˜æŸ¥çœ‹è©³ç´°è³‡è¨Š"})]})})]}),a.jsx("style",{children:`
        .custom-popup .leaflet-popup-content-wrapper {
          background: transparent !important;
          box-shadow: none !important;
          border-radius: 0 !important;
        }
        .custom-popup .leaflet-popup-tip {
          display: none !important;
        }
      `})]})},fe=(o,t)=>new w.DivIcon({className:"custom-numbered-marker",html:`
      <div style="position: relative; width: 32px; height: 32px;">
        <div style="
          position: absolute;
          inset: 0;
          background: ${t?"linear-gradient(135deg, #60a5fa 0%, #0ea5e9 100%)":"linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)"};
          border-radius: 50%;
          opacity: 0.2;
          transform: scale(1.5);
        "></div>
        <div style="
          position: relative;
          width: 100%;
          height: 100%;
          background: ${t?"linear-gradient(135deg, #60a5fa 0%, #0ea5e9 100%)":"linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)"};
          border: 3px solid white;
          border-radius: 50%;
          box-shadow: ${t?"0 0 16px rgba(96, 165, 250, 0.5), 0 3px 10px rgba(0, 0, 0, 0.4)":"0 3px 10px rgba(0, 0, 0, 0.2)"};
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: 800;
          font-size: 14px;
          font-family: sans-serif;
        ">
          ${o+1}
        </div>
      </div>
    `,iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[0,-16]}),pe=new w.DivIcon({className:"custom-user-icon",html:`
    <div style="position: relative; width: 20px; height: 20px; background-color: #10b981; border: 2px solid white; border-radius: 50%; box-shadow: 0 0 12px rgba(16, 185, 129, 0.5), 0 2px 6px rgba(0,0,0,0.3); z-index: 1000;">
      <div style="position: absolute; top: -10px; left: -10px; width: 40px; height: 40px; background-color: rgba(16, 185, 129, 0.25); border-radius: 50%; animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;"></div>
    </div>
    <style> @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } } </style>
  `,iconSize:[20,20],iconAnchor:[10,10]}),xe=({events:o,userLocation:t,routeCoords:e})=>{const n=F();return l.useEffect(()=>{const r=[];if(o.forEach(i=>{i.lat&&i.lon&&r.push([i.lat,i.lon])}),e&&e.length>0&&e.filter((i,s)=>s%10===0).forEach(i=>r.push(i)),t&&t.lat&&t.lon&&r.push([t.lat,t.lon]),r.length>0){const i=w.latLngBounds(r);n.fitBounds(i,{padding:[50,50],maxZoom:15})}},[o,t,e,n]),null},ye=({events:o,userLocation:t,isDarkMode:e,theme:n,onModalToggle:r})=>{const[i,s]=l.useState(!1),[u,f]=l.useState(!1);l.useEffect(()=>{r&&r(i)},[i,r]);const[p,h]=l.useState([]),[v,b]=l.useState(!1),x=l.useMemo(()=>o.filter(d=>d.lat&&d.lon),[o]),j=[35.6895,139.6917],c="https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png";return l.useEffect(()=>{if(x.length<2){h([]);return}(async()=>{b(!0);try{const N=`https://router.project-osrm.org/route/v1/driving/${x.map(E=>`${E.lon},${E.lat}`).join(";")}?overview=full&geometries=geojson`,$=await(await fetch(N)).json();if($.routes&&$.routes[0]){const E=$.routes[0].geometry.coordinates.map(T=>[T[1],T[0]]);h(E)}}catch(m){console.error("Failed to fetch route:",m)}finally{b(!1)}})()},[x]),a.jsxs("div",{className:`relative w-full h-64 rounded-[2rem] overflow-hidden border z-0 group transition-all duration-300
      ${e?"border-neutral-700/50 shadow-[0_8px_30px_rgb(0,0,0,0.3)] bg-[#1a1a1a]":"border-stone-200/60 shadow-[0_8px_30px_rgb(0,0,0,0.04)] bg-[#fdfdfd]"}`,children:[a.jsxs("button",{onClick:d=>{d.stopPropagation(),s(!0),f(!1)},className:`absolute top-4 right-4 z-[1001] flex items-center gap-1.5 px-4 py-2 rounded-full backdrop-blur-md shadow-lg border transition-all duration-300 active:scale-95
          ${e?"bg-blue-500/20 text-blue-400 border-blue-500/30 hover:bg-blue-500/30":"bg-blue-50 text-blue-600 border-blue-200 hover:bg-blue-100"}
        `,children:[a.jsx(q,{className:"w-3.5 h-3.5"}),a.jsx("span",{className:"text-[11px] font-black tracking-wider uppercase",children:"é–‹å•Ÿäº’å‹•åœ°åœ–"})]}),v&&a.jsxs("div",{className:"absolute top-4 left-4 z-[1001] bg-black/50 backdrop-blur-md text-white px-3 py-1.5 rounded-full text-[10px] font-bold flex items-center gap-2",children:[a.jsx(K,{className:"w-3 h-3 animate-spin"}),"è¨ˆç®—è·¯ç·šä¸­..."]}),a.jsx("div",{className:"absolute inset-0 z-[1000] flex items-center justify-center bg-transparent cursor-pointer",onClick:()=>s(!0),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:u&&a.jsx("div",{className:"bg-black/80 text-white px-4 py-2 rounded-full text-xs font-bold backdrop-blur-md shadow-2xl border border-white/10 animate-scale-in",children:"ðŸ” é»žæ“Šé–‹å•Ÿäº’å‹•åœ°åœ–"})}),a.jsxs(U,{center:j,zoom:10,style:{height:"100%",width:"100%"},scrollWheelZoom:!1,dragging:!1,zoomControl:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,children:[a.jsx(G,{attribution:"Â© CARTO, Â© OpenStreetMap",url:c}),a.jsx(xe,{events:x,userLocation:t,routeCoords:p}),p.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(y,{positions:p,pathOptions:{color:e?"rgba(0,0,0,0.4)":"white",weight:8,opacity:.6}}),a.jsx(y,{positions:p,pathOptions:{color:e?"#00d4ff":"#3b82f6",weight:e?5:4,opacity:e?1:.9,lineCap:"round",lineJoin:"round"}}),e&&a.jsx(y,{positions:p,pathOptions:{color:"#00d4ff",weight:5,opacity:.3,lineCap:"round",lineJoin:"round"}})]}),x.map((d,m)=>a.jsx(z,{position:[d.lat,d.lon],icon:fe(m,e),children:a.jsx(O,{className:"custom-popup",closeButton:!1,autoPanPadding:[50,50],children:a.jsxs("div",{className:`p-3 rounded-xl shadow-lg border backdrop-blur-md -m-[13px] -mb-[14px] ${e?"bg-[#1a1a1a]/90 border-neutral-700 text-neutral-200":"bg-white/90 border-stone-100 text-stone-800"}`,children:[a.jsxs("div",{className:"font-bold text-sm mb-1 flex items-center gap-2",children:[a.jsx("span",{className:"flex items-center justify-center w-4 h-4 rounded-full bg-blue-500 text-white text-[9px] font-bold",children:m+1}),d.time," ",d.title]}),a.jsx("div",{className:`text-xs leading-snug ${e?"text-neutral-400":"text-stone-500"}`,children:d.desc})]})})},m)),t&&t.lat&&t.lon&&a.jsx(z,{position:[t.lat,t.lon],icon:pe,zIndexOffset:1e3,children:a.jsx(O,{closeButton:!1,className:"custom-popup",children:a.jsx("div",{className:"p-2 px-3 rounded-full bg-emerald-500 shadow-lg -m-[13px] -mb-[14px]",children:a.jsx("div",{className:"font-bold text-xs text-white text-center whitespace-nowrap",children:"æ‚¨çš„ä½ç½®"})})})})]}),a.jsx("style",{children:`
        .custom-popup .leaflet-popup-content-wrapper {
          background: transparent !important;
          box-shadow: none !important;
          border-radius: 0 !important;
        }
        .custom-popup .leaflet-popup-tip {
          display: none !important;
        }
        /* å¢žåŠ æ¨™è¨˜çš„æ·¡å…¥å‹•ç•« */
        .custom-numbered-marker {
          transition: transform 0.2s ease;
        }
        .custom-numbered-marker:hover {
          transform: scale(1.1);
          z-index: 1000 !important;
        }

        @keyframes modal-in {
          from { opacity: 0; transform: scale(0.95) translateY(10px); }
          to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .animate-modal-in {
          animation: modal-in 0.3s ease-out forwards;
        }
      `}),i&&H.createPortal(a.jsx(de,{isOpen:i,onClose:()=>s(!1),isDarkMode:e,events:o,userLocation:t,routeCoords:p,theme:n}),document.body)]})};export{ye as default};
